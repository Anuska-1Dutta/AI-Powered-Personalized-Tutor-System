import os
import pickle
import json
import requests
from sklearn.feature_extraction.text import TfidfVectorizer

print("Creating enhanced history dataset...")

# Create necessary directories
os.makedirs("model", exist_ok=True)
os.makedirs("data", exist_ok=True)

# Ancient history QA pairs
ancient_history_qa = [
    ("Who was Alexander the Great?", "Alexander the Great (356-323 BCE) was the king of the ancient Greek kingdom of Macedon and one of history's greatest military commanders. He created one of the largest empires of the ancient world, stretching from Greece to northwestern India, and was undefeated in battle. Born to King Philip II, Alexander was tutored by Aristotle in his youth. After his father's assassination, he ascended to the throne at age 20. His conquests spread Greek culture throughout his empire, initiating the Hellenistic period. Alexander's legacy includes founding many cities, most notably Alexandria in Egypt. He died in Babylon at age 32, leaving an indelible mark on history through his military genius, leadership, and the cultural exchange fostered by his conquests."),
    ("What was the Roman Empire?", "The Roman Empire was one of the largest and most influential empires in world history, centered around the city of Rome. It began with the crowning of Emperor Augustus in 27 BCE, following the fall of the Roman Republic, and lasted in the West until 476 CE and in the East (as the Byzantine Empire) until 1453 CE. At its height under Emperor Trajan, it encompassed approximately 5 million square kilometers and over 70 million people—about 21% of the world's population. The empire was characterized by its advanced legal system, extensive road networks, architectural innovations, military might, and the spread of Latin and Greek cultures. Roman institutions, language, law, and culture had a profound and lasting influence on the development of language, religion, architecture, philosophy, law, and government in territories throughout Europe and beyond."),
    ("What was ancient Egypt?", "Ancient Egypt was a civilization in Northeast Africa concentrated along the lower Nile River, lasting from approximately 3100 BCE to 332 BCE when it was conquered by Alexander the Great. One of the world's earliest and longest-lasting civilizations, it was characterized by sophisticated irrigation systems, monumental architecture (particularly the pyramids and temples), a complex religious system, distinctive art, hieroglyphic writing, mathematical and astronomical developments, and a centralized political structure under a divine pharaoh. The civilization is renowned for its cultural achievements, including mummification, the Great Pyramids of Giza, the Great Sphinx, extraordinary tomb art, and advances in medicine, agriculture, and engineering. Ancient Egyptian culture and artifacts continue to fascinate people worldwide and have had an enduring impact on art, architecture, and popular culture."),
    ("What was Mesopotamia?", "Mesopotamia, meaning 'land between rivers' in Greek, was an ancient region in Western Asia situated within the Tigris-Euphrates river system, in modern-day Iraq, Kuwait, parts of Syria, and Turkey. Often referred to as the 'Cradle of Civilization,' it was the site of the world's first urban civilizations from approximately 4500-3100 BCE. Mesopotamia saw the development of many significant innovations: the wheel, the first writing system (cuneiform), mathematics, astronomy, agriculture, law codes, and organized religion. Major civilizations that flourished in this region included the Sumerians, Akkadians, Babylonians, and Assyrians. Each contributed to the area's rich history through their distinct cultures, technological advancements, monumental architecture, and political systems. The Code of Hammurabi, the Epic of Gilgamesh, and the Hanging Gardens of Babylon are among Mesopotamia's most famous cultural contributions."),
    ("Who was Cleopatra?", "Cleopatra VII Philopator (69-30 BCE) was the last active ruler of the Ptolemaic Kingdom of Egypt. A member of the Ptolemaic dynasty, a family of Greek origin, Cleopatra is known for her intelligence, political acumen, and romantic relationships with Roman leaders Julius Caesar and Mark Antony. Fluent in multiple languages, she was the first Ptolemaic ruler to learn Egyptian. Cleopatra restored Egypt's power through careful political maneuvering and alliances with Rome. Her relationship with Julius Caesar produced a son, Caesarion, and after Caesar's assassination, she aligned with Mark Antony against Octavian (later Emperor Augustus). Following their defeat at the Battle of Actium in 31 BCE, both Cleopatra and Antony committed suicide. With her death, Egypt became a province of the Roman Empire. Her life has inspired numerous works of art, literature, and film, often portraying her as a femme fatale and symbol of exotic beauty and power."),
]

# Medieval history QA pairs
medieval_history_qa = [
    ("What was the Byzantine Empire?", "The Byzantine Empire, also known as the Eastern Roman Empire, was the continuation of the Roman Empire in its eastern provinces during Late Antiquity and the Middle Ages. It survived the fall of the Western Roman Empire in 476 CE and lasted until the Fall of Constantinople to the Ottoman Turks in 1453 CE. The empire was centered in Constantinople (modern-day Istanbul), originally named Byzantium, which Emperor Constantine I established as the capital in 330 CE. The Byzantines considered themselves Romans and maintained Roman systems of governance, law, and culture, while incorporating Greek language and culture and Eastern Christian theology. The empire experienced periods of prosperity and decline but remained a major economic, cultural, and military power in the eastern Mediterranean for much of its existence. The Byzantine legacy includes preserving Greek and Roman knowledge, creating distinctive art and architecture (particularly mosaics and the dome-based architectural style), developing Eastern Orthodox Christianity, and influencing cultural and political developments in Eastern Europe, the Middle East, and beyond."),
    ("What were the Crusades?", "The Crusades were a series of religious wars sanctioned by the Latin Church between the 11th and 16th centuries, primarily aimed at recovering the Holy Land from Islamic rule. The First Crusade (1096-1099) was called by Pope Urban II in response to Byzantine Emperor Alexios I's request for help against the Seljuk Turks and resulted in the capture of Jerusalem. Over the next two centuries, seven major crusades and several minor ones were launched. The most prominent include: the Second Crusade (1147-1149), the Third Crusade (1189-1192) led by Richard the Lionheart, the Fourth Crusade (1202-1204) which infamously sacked Constantinople, and the Children's Crusade (1212). The Crusades had far-reaching political, economic, and social impacts: increased trade between Europe and the Middle East, weakened Byzantine power, strengthened European monarchies, expanded papal authority, and unfortunately, increased religious intolerance. While ultimately unsuccessful in their primary goal of permanently securing Christian control of the Holy Land, the Crusades significantly influenced the medieval world and continue to resonate in Christian-Muslim relations today."),
    ("What was the Black Death?", "The Black Death was a devastating global pandemic of bubonic plague that struck Europe and Asia in the mid-14th century (1346-1353). Caused by the bacterium Yersinia pestis and spread primarily by fleas on infected rats, the disease likely originated in Central or East Asia before traveling along trade routes to Europe. The Black Death killed an estimated 75-200 million people—approximately 30-60% of Europe's population—making it one of the deadliest pandemics in human history. Symptoms included painful swollen lymph nodes (buboes), fever, and vomiting blood. The catastrophic death toll led to profound social, economic, and religious changes: labor shortages empowered peasants and workers to demand better conditions, feudalism weakened, religious dogma was questioned, and innovations in medicine and public health emerged. The plague recurred occasionally in Europe until the 19th century. The Black Death's enormous demographic and cultural impact accelerated major historical shifts, including the end of the Middle Ages and the beginning of the Renaissance."),
    ("What was feudalism?", "Feudalism was the dominant social, economic, and political system in medieval Europe from roughly the 9th to 15th centuries. Emerging after the fall of the Roman Empire and the subsequent instability, it was a hierarchical framework organizing society around relationships based on land ownership and military service. At the top of the feudal pyramid was the monarch (king or queen), who granted large estates (fiefs) to nobles (lords) in exchange for loyalty, military service, and taxes. These lords, in turn, granted portions of their land to lesser nobles (vassals) who swore fealty to them. At the bottom of the hierarchy were serfs—peasants bound to the land who farmed for the landowners in exchange for protection and the right to subsistence farming. Feudalism varied considerably across regions and time, but generally featured fragmented authority, local self-sufficiency, an agricultural economy, and a rigid social structure with limited mobility. The system began to decline with the rise of centralized monarchies, urbanization, the growth of a money economy, and the devastation of the Black Death, which created labor shortages and increased peasant bargaining power. By the 16th century, feudalism had largely disappeared from Western Europe."),
    ("Who was Genghis Khan?", "Genghis Khan (born Temüjin, c. 1158-1227) was the founder and first Great Khan of the Mongol Empire, which became the largest contiguous land empire in history after his death. Born into a nomadic tribe in what is now Mongolia, he overcame early hardships—including his father's murder and his family's abandonment by their clan—to unify the nomadic tribes of the Mongolian plateau. Through a combination of military genius, political acumen, and brutal efficiency, he conquered much of Central Asia and China. Under his rule and that of his descendants, the Mongol Empire eventually stretched from Korea to Eastern Europe. Genghis Khan revolutionized Mongol society, abolishing the tribal system and replacing it with one based on loyalty and merit. He implemented a sophisticated postal system (the Yam), religious tolerance, a universal writing system, and meritocratic administration. His military innovations included the decimal system of organization, psychological warfare, superior cavalry tactics, and effective siege warfare. Despite his reputation for brutality in warfare, he created a stable empire that facilitated Eurasian trade and cultural exchange (the Pax Mongolica). Genetic studies suggest he may have up to 16 million male descendants living today. His legacy as a leader, nation-builder, and military strategist has made him an iconic figure in world history."),
]

# Modern history QA pairs
modern_history_qa = [
    ("What was the Renaissance?", "The Renaissance was a transformative cultural, artistic, political, and intellectual movement that originated in Italy in the 14th century and spread throughout Europe until the 17th century. The term, meaning 'rebirth' in French, reflects the period's revival of interest in classical Greek and Roman knowledge, art, and values. Key characteristics of the Renaissance included: humanism, which emphasized human potential and achievement; scientific inquiry based on observation and reason rather than religious dogma; artistic innovations such as perspective, realism, and anatomical accuracy; secular themes in art alongside religious ones; and the flourishing of literature and philosophy in vernacular languages. Notable Renaissance figures included Leonardo da Vinci, Michelangelo, Raphael, Botticelli, Machiavelli, Galileo, Shakespeare, and Erasmus. Technological developments such as the printing press, invented by Johannes Gutenberg around 1440, accelerated the spread of ideas. The Renaissance marked the transition from the Medieval period to the Early Modern age, laying foundations for the Scientific Revolution, the Enlightenment, and modern Western thought. It was fueled by increasing wealth from trade, the patronage of wealthy families like the Medici, and the influx of scholars from Constantinople after its fall to the Ottoman Empire in 1453."),
    ("What was the Industrial Revolution?", "The Industrial Revolution was a period of major industrialization and innovation that transformed largely rural, agrarian societies in Europe and America into industrialized, urban ones. Beginning in Great Britain around 1760 and continuing until approximately 1840, it soon spread to Western Europe and North America. The revolution was characterized by the transition from hand production methods to machine manufacturing, the development of iron-making techniques and the increased use of refined coal, the mechanization of textile production, the growth of factories, extensive railway networks, and steamship technology. Key innovations included the steam engine, improved by James Watt; the spinning jenny, invented by James Hargreaves; and the telegraph, developed by Samuel Morse. The Industrial Revolution led to unprecedented economic growth, urbanization, higher standards of living for some, and the rise of the middle class. However, it also brought negative consequences: harsh working conditions, child labor, environmental pollution, and growing class divisions. The social and economic changes it initiated were so profound that historians consider it one of the most important turning points in human history, fundamentally altering almost every aspect of daily life and creating the foundations of modern society."),
    ("What was World War I?", "World War I (1914-1918), also known as the First World War or the Great War, was a global conflict originating in Europe that involved most of the world's great powers, assembled in two opposing alliances: the Allies (primarily based around the Triple Entente of Britain, France, and Russia) and the Central Powers (originally centered around the Triple Alliance of Germany, Austria-Hungary, and Italy, though Italy later joined the Allies). The immediate trigger was the assassination of Archduke Franz Ferdinand of Austria-Hungary by a Bosnian Serb nationalist on June 28, 1914, which set off a chain of diplomatic crises and military mobilizations. Underlying causes included imperial competition, militarism, complex alliance systems, nationalism, and territorial disputes. The war was characterized by unprecedented industrial-scale killing, with new weapons such as machine guns, tanks, poison gas, and aircraft. Most fighting occurred in trench warfare on the Western Front in France and Belgium, though significant fighting also took place on the Eastern Front, in the Middle East, Africa, and at sea. The war ended with the defeat of the Central Powers and the signing of the Treaty of Versailles in 1919, which imposed harsh penalties on Germany. The human cost was staggering: approximately 9 million soldiers and 13 million civilians died, with millions more wounded. The conflict reshaped the world map, contributed to the fall of four empires (German, Russian, Ottoman, and Austro-Hungarian), sparked the Russian Revolution, facilitated the rise of the United States as a global power, and laid the groundwork for World War II. It is considered one of the deadliest and most consequential conflicts in human history."),
    ("What was World War II?", "World War II (1939-1945) was a global conflict that involved the majority of the world's nations, forming two opposing military alliances: the Allies (led by the United States, the United Kingdom, the Soviet Union, and China) and the Axis powers (led by Nazi Germany, Imperial Japan, and Fascist Italy). The war began on September 1, 1939, when Germany invaded Poland, prompting Britain and France to declare war on Germany. The conflict expanded with Germany's conquests in Europe, Japan's aggression in Asia (which had begun earlier in 1937 with the Second Sino-Japanese War), and Italy's invasions in Africa and the Mediterranean. Key events included the German blitzkrieg across Europe, the Battle of Britain, Operation Barbarossa (the German invasion of the Soviet Union), the Japanese attack on Pearl Harbor, the Holocaust, the D-Day landings in Normandy, and the atomic bombings of Hiroshima and Nagasaki. The war ended with the Axis defeat, following the Allied invasion of Germany and the Soviet capture of Berlin in May 1945, and Japan's surrender in August 1945 after the atomic bombings. World War II resulted in an estimated 70-85 million fatalities, including the systematic genocide of 6 million Jews and millions of others in the Holocaust. It led to significant geopolitical changes: the decline of Western European powers, the rise of the United States and the Soviet Union as superpowers, the beginning of the Cold War, the creation of the United Nations, decolonization movements, and accelerated advances in technology and science. It remains the deadliest military conflict in human history and fundamentally reshaped the political, economic, and social structures of the 20th century."),
    ("What was the Cold War?", "The Cold War (1947-1991) was a period of geopolitical tension between the United States and its allies (primarily the Western democratic, capitalist states of NATO) and the Soviet Union and its satellite states (the Eastern Bloc of communist nations). The term 'cold' reflects the absence of direct large-scale fighting between the two superpowers, though they engaged in proxy wars, an arms race, espionage, propaganda, and technological competition, most notably the Space Race. The conflict was rooted in the ideological and political differences between capitalism and communism that emerged after World War II. Key events and aspects included: the Truman Doctrine (1947) and Marshall Plan, the Berlin Blockade (1948-1949), the formation of NATO (1949) and the Warsaw Pact (1955), the Korean War (1950-1953), the Cuban Missile Crisis (1962), the Vietnam War (1955-1975), détente in the 1970s, the Soviet-Afghan War (1979-1989), and the fall of the Berlin Wall (1989). The Cold War ended with the collapse of the Soviet Union in 1991. Its legacies include nuclear proliferation, a divided Korea, the establishment of the modern intelligence community, significant technological developments (including space exploration and the internet), cultural and ideological influences, and the reshaping of the international order from a bipolar to a unipolar world briefly dominated by the United States."),
]

# Indian history QA pairs
indian_history_qa = [
    ("Who was Rana Pratap Singh?", "Maharana Pratap Singh I (1540-1597) was a Hindu Rajput king of Mewar in Rajasthan, India, and a prominent member of the Sisodia clan. He is widely celebrated as a folk hero for his resistance against the expansion of the Mughal Empire under Emperor Akbar. Born as the eldest son of Maharana Udai Singh II, he succeeded to the throne in 1572 after his father's death, refusing to acknowledge Mughal suzerainty. His most famous battle was the Battle of Haldighati in 1576 against Akbar's forces led by Man Singh I of Amber, where Pratap fought valiantly but was ultimately forced to retreat. Despite this defeat, he continued to conduct guerrilla warfare from his base in the Aravalli hills and eventually recaptured much of his lost territory before his death. Maharana Pratap is revered throughout India for his courage, unwavering commitment to independence, patriotism, and selfless service to his people. His legendary horse, Chetak, who sacrificed his life to save his master during the Battle of Haldighati, is also an integral part of his heroic legend. The annual Maharana Pratap Jayanti celebrates his birth anniversary and commemorates his legacy of bravery and resistance against foreign rule."),
    ("What was the Indus Valley Civilization?", "The Indus Valley Civilization (IVC), also known as the Harappan Civilization, was one of the world's earliest urban civilizations, flourishing in the northwestern regions of South Asia from approximately 3300 BCE to 1300 BCE. At its peak (2600-1900 BCE), it covered a vast territory encompassing much of what is now Pakistan, western India, and parts of Afghanistan. Major urban centers included Harappa, Mohenjo-daro, Dholavira, and Lothal. The civilization was remarkable for its sophisticated city planning with grid-patterned streets, advanced drainage systems, multi-story buildings, public baths, granaries, and standardized weights and measures. The Harappans developed a form of writing that remains largely undeciphered. They engaged in extensive trade networks reaching as far as Mesopotamia and Central Asia. The civilization gradually declined, possibly due to climate change, drought, flooding, or shifts in river courses. The IVC's legacy includes contributions to agriculture, metallurgy, craftsmanship, and urban planning, and it represents a crucial chapter in the development of civilization in South Asia."),
    ("What was the Mughal Empire?", "The Mughal Empire was an early modern empire founded by Babur, a descendant of Genghis Khan and Timur, after his victory at the First Battle of Panipat in 1526. At its peak, it controlled most of the Indian subcontinent and parts of present-day Afghanistan. The empire reached its zenith under Emperor Akbar (ruled 1556-1605), who implemented policies of religious tolerance, administrative reform, and cultural synthesis. Other significant emperors included Jahangir, Shah Jahan (who built the Taj Mahal), and Aurangzeb, whose long reign (1658-1707) saw territorial expansion but also increasing religious orthodoxy. The Mughal period is renowned for its architectural achievements, including Humayun's Tomb, the Red Fort, and Fatehpur Sikri; artistic developments, particularly in miniature painting; literature, including Persian and Urdu poetry; and administrative innovations such as the mansabdari system. The empire began to decline after Aurangzeb's death, facing challenges from regional powers, foreign invasions, and internal conflicts. By the mid-19th century, it had been reduced to a nominal entity under British protection before being formally dissolved following the Rebellion of 1857. The Mughal legacy profoundly influenced South Asian culture, art, cuisine, and governance, and it represents a significant chapter in Indian history, characterized by a synthesis of Persian, Central Asian, and Indian cultural elements."),
    ("What was the British Raj?", "The British Raj refers to the period of direct British colonial rule over the Indian subcontinent from 1858 to 1947. It began after the Indian Rebellion of 1857 (also called the Sepoy Mutiny), when the British Crown assumed direct control from the East India Company, and ended with the partition of British India into the independent nations of India and Pakistan. During this period, the British administered the region through a complex bureaucratic system, with ultimate authority vested in the British monarch represented by the Viceroy of India. The Raj introduced Western education, a modern legal system, railways, telegraphs, and irrigation systems, while also implementing policies that often exploited India's resources and labor for Britain's benefit. It faced growing Indian nationalism in the late 19th and early 20th centuries, with the Indian National Congress (founded in 1885) and later the Muslim League becoming significant political forces. Major events during this period included the partition of Bengal (1905), the transfer of the capital from Calcutta to Delhi (1911), the Jallianwala Bagh massacre (1919), the Civil Disobedience Movement led by Mahatma Gandhi, and World War II, which strained British resources and accelerated the independence movement. The British Raj's legacy remains complex and contested, having profoundly shaped modern South Asia's political boundaries, governance institutions, educational systems, and infrastructure, while also being criticized for economic exploitation, cultural imperialism, and policies that exacerbated religious and communal divisions."),
    ("What was the Indian Independence Movement?", "The Indian Independence Movement was a historic struggle to liberate the Indian subcontinent from British colonial rule, spanning from the mid-19th century until independence in 1947. Early resistance included the Indian Rebellion of 1857, but the organized movement began with the formation of the Indian National Congress in 1885. The struggle evolved through distinct phases: the moderate phase (1885-1905) focusing on constitutional reforms, the Swadeshi movement following Bengal's partition in 1905, and the Home Rule movement during World War I. Under Mahatma Gandhi's leadership from 1915, the movement adopted non-violent civil disobedience (satyagraha) through campaigns like Non-Cooperation (1920-1922), Civil Disobedience (1930-1934), and Quit India (1942). Other significant leaders included Bal Gangadhar Tilak, Lala Lajpat Rai, Bipin Chandra Pal, Jawaharlal Nehru, Sardar Patel, and Subhas Chandra Bose, who formed the Indian National Army to fight alongside Japan during World War II. The Muslim League, led by Muhammad Ali Jinnah, advocated for a separate Muslim state (Pakistan). After World War II, Britain's weakened position and continued Indian resistance led to independence, though with the traumatic partition of the subcontinent into India and Pakistan, resulting in mass migration and communal violence. The Indian Independence Movement inspired anti-colonial struggles worldwide and demonstrated the power of non-violent resistance. Its legacy continues to influence national identity, politics, and international relations in modern South Asia."),
]

# U.S. history QA pairs
us_history_qa = [
    ("Who was Abraham Lincoln?", "Abraham Lincoln (1809-1865) was the 16th President of the United States, serving from March 1861 until his assassination in April 1865. Born in a log cabin in Kentucky to a poor farming family, Lincoln was largely self-educated. He worked as a railsplitter, flatboat operator, storekeeper, postmaster, and lawyer before entering politics. Rising from humble beginnings to the nation's highest office, he led the United States through its greatest constitutional, military, and moral crisis—the American Civil War (1861-1865). Lincoln's primary achievement was preserving the Union while ending slavery. His Emancipation Proclamation of 1863 declared slaves in Confederate states to be free, and he later pushed for the Thirteenth Amendment, which abolished slavery nationwide. Lincoln's presidency was marked by his eloquence, commitment to national unity, political genius, and moral authority. His Gettysburg Address of 1863 became an iconic statement of America's founding principles. On April 14, 1865, just days after the war's end, he was assassinated by John Wilkes Booth at Ford's Theatre in Washington, D.C. Lincoln is consistently ranked by historians and the public as one of the greatest U.S. presidents, embodying wisdom, integrity, and determination during the nation's darkest hour. His legacy includes transforming the presidency, modernizing the economy, strengthening the federal government, and redefining American democracy around the principles of liberty and equality."),
    ("What was the American Revolution?", "The American Revolution (1775-1783) was the political upheaval during the last half of the 18th century in which thirteen North American colonies rejected British rule and formed the United States of America. The conflict arose from growing tensions between residents of the colonies and the British authorities, particularly regarding taxation without colonial representation in Parliament. Key events that escalated tensions included the Stamp Act (1765), Boston Massacre (1770), Boston Tea Party (1773), and the Intolerable Acts (1774). The war began on April 19, 1775, with the Battles of Lexington and Concord. In 1776, the Second Continental Congress issued the Declaration of Independence, primarily authored by Thomas Jefferson, which articulated the philosophical justification for independence based on natural rights and listed grievances against King George III. Under George Washington's leadership as commander-in-chief, the Continental Army, supported by French allies after 1778, ultimately defeated British forces despite early setbacks. The war officially ended with the Treaty of Paris in 1783, by which Great Britain recognized American independence and ceded territory east of the Mississippi River. Beyond securing independence, the Revolution established a republic based on Enlightenment principles of liberty, individual rights, and self-government—ideas that would influence democratic movements worldwide. The Revolution's legacy includes the U.S. Constitution, the Bill of Rights, and the creation of a democratic tradition that continues to evolve, though initially limited to white male property owners."),
    ("What was the American Civil War?", "The American Civil War (1861-1865) was a brutal, devastating conflict that divided the United States between the Union (North) and the Confederacy (South). The fundamental cause was slavery, particularly disputes over its expansion into new territories, though economic differences, states' rights, and sectional tensions also contributed. The war began on April 12, 1861, when Confederate forces attacked Fort Sumter in South Carolina, following the election of Abraham Lincoln and the secession of 11 Southern states. Major battles included Bull Run, Antietam, Gettysburg, and Vicksburg, with generals like Ulysses S. Grant, Robert E. Lee, William T. Sherman, and Thomas \"Stonewall\" Jackson emerging as key military leaders. President Lincoln's Emancipation Proclamation (1863) declared slaves in Confederate states free, transforming the war into a struggle not just to preserve the Union but to end slavery. The conflict concluded with Lee's surrender to Grant at Appomattox Court House on April 9, 1865, though fighting continued briefly elsewhere. The war resulted in approximately 750,000 deaths, destroyed much of the South's infrastructure, and fundamentally altered American society. The ensuing Reconstruction period (1865-1877) attempted to reintegrate the South and establish civil rights for freed slaves, though these efforts were ultimately undermined by white resistance and federal policy shifts. The Civil War remains the deadliest conflict in U.S. history and profoundly shaped the nation's development, eliminating slavery, strengthening federal authority, accelerating industrialization, and leaving an enduring cultural legacy, particularly regarding race relations."),
    ("What was the Great Depression?", "The Great Depression was a severe worldwide economic downturn that lasted from 1929 to the late 1930s, beginning in the United States after a major fall in stock prices on October 29, 1929 (Black Tuesday). It was the longest, deepest, and most widespread depression of the 20th century. The depression fundamentally changed economic institutions, policies, and understanding. In the U.S., unemployment rose to 25%, banks failed in waves, industrial production fell by nearly 45%, and prices dropped by 33%. International trade plunged by more than 50%. Rural areas suffered as crop prices fell by approximately 60%. While the stock market crash triggered the crisis, underlying causes included the uneven distribution of wealth, extensive bank failures, reduction in purchasing power, the gold standard, contractionary monetary policy, and the 1930 Smoot-Hawley Tariff Act, which raised import duties and reduced trade. President Herbert Hoover's initial limited government response proved inadequate. Franklin D. Roosevelt's election in 1932 brought the New Deal—a series of programs, public works projects, financial reforms, and regulations that provided relief for the unemployed and poor, recovered the economy, and reformed the financial system. Key initiatives included the Civilian Conservation Corps, the Social Security Act, the Securities and Exchange Commission, and banking reforms. The depression ended in the United States around 1939, as World War II mobilization revitalized the economy. The Great Depression's legacy includes the modern welfare state, stronger financial regulations, Keynesian economics, and a transformed understanding of government's role in the economy."),
    ("What was the Civil Rights Movement?", "The Civil Rights Movement was a decades-long struggle by African Americans and their allies to end institutionalized racial discrimination, disenfranchisement, and racial segregation in the United States. While the movement spans from the late 19th century to the present day, its most intense period occurred from the 1950s through the late 1960s. The movement was characterized by nonviolent protest, civil disobedience, litigation, and grassroots organizing, though more militant approaches also emerged. Key events and milestones included: the 1954 Supreme Court decision in Brown v. Board of Education, which declared segregation in public schools unconstitutional; the Montgomery Bus Boycott (1955-1956), sparked by Rosa Parks' refusal to give up her seat to a white passenger; the Little Rock Nine's integration of Central High School (1957); student sit-ins at segregated lunch counters beginning in 1960; the Freedom Rides challenging segregation in interstate transportation (1961); the March on Washington (1963), where Martin Luther King Jr. delivered his 'I Have a Dream' speech; the Civil Rights Act of 1964, outlawing discrimination based on race, color, religion, sex, or national origin; the Voting Rights Act of 1965, prohibiting racial discrimination in voting; and the Fair Housing Act of 1968. Prominent leaders included Martin Luther King Jr., who advocated nonviolent resistance; Malcolm X, who promoted Black nationalism and self-defense; Rosa Parks; John Lewis; Medgar Evers; Bayard Rustin; Ella Baker; Thurgood Marshall; and organizations like the NAACP, SCLC, SNCC, and CORE. The movement achieved significant legal victories and transformed American society, though racial inequality persists in many areas. Its tactics, philosophy, and moral authority have inspired numerous other social justice movements worldwide."),
]

# Combined history QA pairs
history_qa_pairs = ancient_history_qa + medieval_history_qa + modern_history_qa + indian_history_qa + us_history_qa

# Try to download additional data from external sources
try:
    print("Attempting to download additional history datasets...")
    
    # Try to fetch additional historical content
    history_urls = [
        "https://raw.githubusercontent.com/manindersingh030/HistoryGPT-Dataset/main/data-sample.json"
    ]
    
    for url in history_urls:
        try:
            response = requests.get(url, timeout=10)
            if response.status_code == 200:
                try:
                    data = response.json()
                    if isinstance(data, list):
                        for item in data[:20]:  # Limit to first 20 items
                            if 'query' in item and 'response' in item:
                                q = item.get('query', '')
                                a = item.get('response', '')
                                
                                if len(q) > 10 and len(a) > 20:  # Ensure reasonable length
                                    history_qa_pairs.append((q, a))
                    elif isinstance(data, dict) and 'data' in data:
                        for item in data.get('data', [])[:20]:
                            if 'question' in item and 'answer' in item:
                                q = item.get('question', '')
                                a = item.get('answer', '')
                                if len(q) > 10 and len(a) > 20:
                                    history_qa_pairs.append((q, a))
                    
                    print(f"Successfully processed data from {url}")
                except json.JSONDecodeError:
                    print(f"Could not parse JSON from {url}")
            else:
                print(f"Failed to download from {url}, status code: {response.status_code}")
        except Exception as e:
            print(f"Error processing {url}: {str(e)}")
    
    # Add fallback history topics as a backup
    history_events = [
        "French Revolution", "Russian Revolution", "Ancient Greece", "Maya Civilization", 
        "Ottoman Empire", "Samurai", "Vikings", "Roman Republic", "Ming Dynasty", "Aztec Empire"
    ]
    
    for event in history_events:
        question = f"What was the {event}?"
        answer = f"The {event} was a significant historical period or entity that played an important role in shaping world history. It involved key figures, social structures, and events that influenced subsequent historical developments and continues to be studied by historians for its impact on human civilization."
        history_qa_pairs.append((question, answer))
    
    print(f"Added {len(history_events)} basic history topic definitions")

except Exception as e:
    print(f"Error downloading additional datasets: {str(e)}")
    print("Using only the predefined QA pairs...")

# Create a history-specific dataset
print(f"Creating history dataset with {len(history_qa_pairs)} QA pairs")

# Prepare the dataset structure
history_training_data = {"History": []}
for question, answer in history_qa_pairs:
    history_training_data["History"].append(question)
    history_training_data["History"].append(answer)

# Create a TF-IDF vectorizer
vectorizer = TfidfVectorizer()
all_questions = [q for q in history_training_data["History"][::2]]
X = vectorizer.fit_transform(all_questions)

# Save the model components
model_path = 'model/history_model.pkl'
with open(model_path, 'wb') as f:
    pickle.dump((vectorizer, X, history_training_data), f)

print(f"History model successfully created and saved to {model_path}")
print(f"Dataset contains {len(all_questions)} questions")

# Merge with existing AI tutor model
try:
    existing_model_path = 'model/large_ai_tutor_model.pkl'
    if os.path.exists(existing_model_path):
        print("Found existing large AI tutor model, merging history data...")
        
        with open(existing_model_path, 'rb') as f:
            existing_model_data = pickle.load(f)
            
        if isinstance(existing_model_data, tuple) and len(existing_model_data) == 3:
            combined_vectorizer, combined_X, combined_training_data = existing_model_data
            
            # Merge history data with existing data
            combined_training_data["History"] = history_training_data["History"]
            
            # Create a new combined vectorizer and feature matrix
            combined_questions = []
            for subject, qa_list in combined_training_data.items():
                combined_questions.extend(qa_list[::2])
                
            new_vectorizer = TfidfVectorizer()
            new_X = new_vectorizer.fit_transform(combined_questions)
            
            # Save the combined model
            with open(existing_model_path, 'wb') as f:
                pickle.dump((new_vectorizer, new_X, combined_training_data), f)
                
            print(f"Combined model successfully updated at {existing_model_path}")
            print(f"Combined dataset now contains {len(combined_questions)} questions across {len(combined_training_data)} subjects")
except Exception as e:
    print(f"Error merging with existing model: {str(e)}")
    print("History-only model was still created successfully.")

print("Done! Run the app.py file to start using the enhanced history model.") 